!function(e){function t(){var t=[];try{jQuery.each(jQuery("#facetList .EXLFacetContainer"),function(n,r){r=e(r);var a=e(r).find('*[class*="EXLFacetTitleLabelPHolder"]');if(a.length>0)r.name=e(r).find('*[class*="EXLFacetTitleLabelPHolder"]').attr("class").replace("EXLFacetTitleLabelPHolder",""),r.title=e(r).find('*[class*="EXLFacetTitleLabelPHolder"]').text().trim();else try{var i=r.find(".EXLFacet a").attr("href").match(/fctN=(.*?)\&/);r.name=i.length>1?i[1]:"",r.title=r.find("h4").text().trim()||""}catch(o){r.name="",r.title=""}r.index=n,r.values=[],e.each(r.find(".EXLFacet"),function(t,n){n=e(n),n.value=e(n).find("a").text().trim()||"",n.url=e(n).find("a").attr("href")||"",n.count=e(n).find("span").text().trim().replace(/\.|\,/g,"").replace(/\(/g,"").replace(/\)/g,"")||0,r.values.push(n)}),t.push(r)}),t.getNames=function(){return e.map(t,function(e){return e.name})},t.getByName=function(e){return t.filter(function(t){return t.name===e})[0]}}catch(n){console.log("unable to load facets",n)}return t}function n(){function t(){var e=jQuery(window.location.search.replace(/^\?/,"").split("&")).map(function(){var e=this,t=e.split("="),n={};return n[decodeURIComponent(t[0])]=decodeURIComponent(t[1]),n});return e.lookup=function(t){var n=[];return jQuery.each(e,function(r,a){var i=jQuery(Object.keys(a)).map(function(){var e=this,n=e.match(t.replace(/\(/g,"\\(").replace(/\)/g,"\\)"));return n?e:null}).filter(function(e){return null!=e})[0];i&&""!=i&&n.push(e[r][i])}),n},e}function n(){var e="";if(r()){var t=jQuery(window.location.search.replace(/^\?/,"").split("&")).map(function(){var e=this,t=e.split("="),n={};return n[decodeURIComponent(t[0])]=decodeURIComponent(t[1]),n});e=t.length>0?t[0].query.replace(/\,/g," "):""}else jQuery(f).each(function(t,n){n.term.trim().length>0&&(e+="("+n.index+" "+n.precision+" "+n.term+")",e+=n.term.length>0&&t<f.length-1?" "+n.operator.trim()+" ":"")}),jQuery(c).each(function(t,n){n.term.trim().length>0&&(e+=e.length>0&&t<f.length-1?" "+n.operator.trim()+" ":"",e+=n.exclude?" NOT":"",e+="("+n.index+" "+n.precision+" "+n.term+")")});return e}function r(){return null!=window.location.href.match("dlSearch.do")}function a(){var e=u.lookup("scp.scps")[0];return void 0===e&&(e=""),e}function i(){var t=u.lookup("tab")[0];if(void 0===t){var n=e("#exlidSearchTabs li.EXLSearchTabSelected").find("a").attr("href").split("&").filter(function(e){return/^tab/.test(e)});n&&n.length>0&&(t=n[0].replace(/^tab=/,""))}return t}function o(){var e=u.lookup("srt")[0];return void 0===e&&(e=""),e}function l(){var e=u.lookup("mode")[0];return void 0===e&&(e="Basic"),e}var u=t(),c=[];if(void 0!==u.lookup("ct")[0]){var s={inc:[],exc:[]};jQuery.merge(s.inc,u.lookup("fctN")),jQuery.merge(s.inc,u.lookup("mulIncFctN")),jQuery.merge(s.exc,u.lookup("mulExcFctN"));var d={inc:[],exc:[]};jQuery.merge(d.inc,u.lookup("fctV")),jQuery.merge(d.inc,u.lookup("fctIncV")),jQuery.merge(d.exc,u.lookup("fctExcV")),jQuery(Object.keys(s)).each(function(e,t){jQuery(s[t]).each(function(e,n){var r="";r=e<=d[t].length?d[t][e]:"",c.push({index:n,precision:"exact",term:r,operator:"AND",exclude:"exc"===t})})})}var f=[];if(void 0!==u.lookup("mode")[0]&&"Basic"===u.lookup("mode")[0])e(u.lookup("freeText")).each(function(e,t){f.push({index:"any",precision:"contains",term:t,operator:"AND",exclude:!1})});else{e(u.lookup("freeText")).each(function(e){f.push({index:u.lookup("UI"+e)[0]||"any",precision:u.lookup("StartWith"+e)[0]||"contains",term:u.lookup("freeText"+e)[0]||"",operator:u.lookup("boolOperator"+e)[0]||"AND",exclude:!1})});var p={};jQuery(".EXLSearchFieldRibbonFormFieldsGroup2 input:visible,.EXLSearchFieldRibbonFormFieldsGroup2 select:visible").each(function(t,n){var r=e(n).attr("id").replace(/^.*[i|I]nput_/,"").replace(/_$/,"");p[r]=e(n).attr("name")}),jQuery(Object.keys(p)).each(function(e,t){var n=t,r=u.lookup(p[n])[0]||"";f.push({index:n,precision:"contains",term:decodeURIComponent(r),operator:"AND",exclude:!1})})}var y=parseInt(jQuery("#resultsNumbersTile em:first").text().replace(/[\s,]+/g,"").replace(/\.|\,/g,"")),b=parseInt(e("#resultsNumbersTile span:first").text().replace(/[^\d|-]*/g,"").split("-")[1]),g=1;return isNaN(b)?(b=10,g=1):(b=parseInt(e("#resultsNumbersTile span:first").text().replace(/[^\d|-]*/g,"").split("-")[1])-parseInt(e("#resultsNumbersTile span:first").text().replace(/[^\d|-]*/g,"").split("-")[0])+1,g=Math.floor(parseInt(e("#resultsNumbersTile span:first").text().replace(/[^\d|-]*/g,"").split("-")[1])/b)),f.toText=function(){return n()},{isDeeplinkSearch:r,count:y,step:b,page:g,type:l(),tab:i(),sortedBy:o(),scope:a(),facets:c,query:f}}function r(e,t){var n=null,r=jQuery(jQuery(".EXLResult")[e]);return r.index=e,r.id=r.find(".EXLResultRecordId[name]").attr("name"),r.title=r.find(".EXLResultTitle").text().trim(),r.openUrl=r.find(".EXLMoreTab a").attr("href"),r.tabs=f(r),r.materialType=function(){return l(r)},r.rawData=t[r.id],r.getIt1=function(){return u(r)},r.getDedupedRecordIds=function(){return o(r.id).data()},r.isRemoteRecord=function(){return"TN"===r.id.substring(0,2)},r.isOnEShelf=function(){return-1!=r.find(".EXLMyShelfStar a").attr("href").search("fn=remove")},r.isDedupedRecord=function(){return a(r.id)},r.isFrbrRecord=function(){return i(r)},r.getPNX=function(e){return v(r.id,e)},r.getData=function(){if(!n){var e;r.rawData&&null!=r.rawData?n=r.rawData:(e=v(r.id,"json"),e&&e.length>0&&(n=e[0]))}return n},r}function a(e){return-1!=e.search(/^dedupmrg/)}function i(e){return e.find(".EXLResultFRBR").length>0}function o(e){var t=[];return{data:function(){return 0===t.length&&a(e)&&jQuery.ajax({async:!1,type:"get",dataType:"json",url:jQuery.PRIMO.parameters.base_path+"/record/resolve/"+e}).done(function(e){t=e}).fail(function(){console.log("Error resolving "+e)}),t}}}function l(e){return e.getData().display.type}function u(t){var n=t.tabs.getByName("ViewOnline"),r="",a=[],i=[];return n&&n.length>0&&(i=e(n.find('input[id*="getitonline1"]')).val().split(/&O\d=/),a=e.map(i,function(e){return e.match(/^delivery/)?e.replace(/delivery,.*?,/,""):void 0}),r=a.length>0?a[0]:""),r}function s(){return{byRecordId:function(t,n){if(void 0===t)throw"You must supply a record id";var r=void 0!==n&&void 0!==n.institution?n.institution:jQuery.PRIMO.session.view.institution.code,a=void 0!==n&&void 0!==n.index?n.index:1,i=void 0!==n&&void 0!==n.bulkSize?n.bulkSize:10,o=[];return jQuery.get("/PrimoWebServices/xservice/search/brief?institution="+r+"&query=rid,contains,"+t+"&indx="+a+"&bulkSize="+i).done(function(t){o=e(g(t))}).fail(function(){console.log("error searching")}),o},byQuery:function(t,n){var r=[];try{var a=void 0!==n&&void 0!==n.institution?n.institution:jQuery.PRIMO.session.view.institution.code,i=void 0!==n&&void 0!==n.index?n.index:1,o=void 0!==n&&void 0!==n.bulkSize?n.bulkSize:10,l=void 0!==n&&void 0!==n.apiKey?n.apiKey:null,u=void 0!==n&&void 0!==n.regionURL?n.regionURL:"https://api-eu.hosted.exlibrisgroup.com",c=void 0!==n&&void 0!==n.restAPI?n.restAPI:!1;if(Array.isArray(t)||(t=[t]),c){var s="q="+t.join(";")+"&inst="+a+"&offset="+i+"&limit="+o;return s=l?u+"/primo/v1/pnxs?"+s+"&apikey="+l:"/primo_library/libweb/webservices/rest/v1/pnxs?"+s,jQuery.ajax({async:!1,cache:!1,type:"get",dataType:"json",url:s,beforeSend:function(){}}).done(function(e){r="string"==typeof e?JSON.parse(e):e}).fail(function(){console.log("error searching",f.message)}),r}var d="";if(jQuery.each(t,function(e,t){d+="&query="+t}),t=d,jQuery.ajax({async:!1,cache:!1,type:"get",dataType:"xml",url:"/PrimoWebServices/xservice/search/brief?institution="+a+"&indx="+i+"&bulkSize="+o+t}).done(function(t){r=e(g(t))}).fail(function(){console.log("error searching",f.message)}),r.length>0&&r[0].hasOwnProperty("JAGROOT"))return r[0].JAGROOT.RESULT.DOCSET.DOC;r.length>0&&r[0].hasOwnProperty("MESSAGE")&&console.log(r[0].MESSAGE)}catch(f){console.log("error searching: ",f.message)}return null}}}function d(t,n){var r=null;try{if("number"==typeof n?(r=t.find(".EXLResultTab")[n],0==r.length&&(r=null)):"string"==typeof n&&(r=t.find('.EXLResultTab:contains("'+n+'")'),0==r.length&&(r=t.find(".EXLResultTab[id*='"+n+"']")),0==r.length&&(r=t.find(".EXLResultTab[id*='"+n.toLowerCase()+"']")),(null==r||0==r.length)&&(r=e(t.tabs).find('a[title*="'+n+'"]').parent()),(null==r||0==r.length)&&(r=e(t).find('li[class*="'+n+'"]')),null!==r&&0==r.length&&(r=null)),null!==r){var a;a=void 0===jQuery(r).attr("name")?jQuery(r).attr("id").split("-")[1].replace("tab",""):jQuery(r).attr("name").trim();var i=null,o=(a.trim().charAt(0).toLowerCase()+a.trim().slice(1)).replace(/tab$/gi,""),l="Container-"+o+"Tab";c=t.find('*[class*="'+l+'"]'),c.length>0&&(i=c),r.index=n,r.label=jQuery(r).find("a").text().trim(),r.name=a,r.container=i,r.isOpen=function(){return jQuery(r).hasClass("EXLResultSelectedTab")},r.close=function(){jQuery.PRIMO.session.view.isFullDisplay()||(t.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),t.find(".EXLTabsRibbon").addClass("EXLTabsRibbonClosed"),r.container.hide())},r.open=function(e,n){defaults={reload:!1,headerContent:"",url:"#"};var r=jQuery.extend(defaults,n);if(currentTab=t.tabs.getByName(a),t.find(".EXLTabsRibbonClosed").removeClass("EXLTabsRibbonClosed"),t.find(".EXLResultSelectedTab").removeClass("EXLResultSelectedTab"),jQuery(currentTab).addClass("EXLResultSelectedTab"),t.find(".EXLResultTabContainer").hide(),currentTab.container.show(),!currentTab.container.data("loaded")||r.reload){var i='<div class="EXLTabHeaderContent">'+r.headerContent+'</div><div class="EXLTabHeaderButtons"><ul><li class="EXLTabHeaderButtonPopout"><a href="'+r.url+'" target="_blank"><img src="../images/icon_popout_tab.png" /></a></li><li></li><li class="EXLTabHeaderButtonCloseTabs"><a href="#" title="hide tabs"><img src="../images/icon_close_tabs.png" alt="hide tabs"></a></li></ul></div>',o='<div class="EXLTabHeader">'+i+"</div>",l='<div class="EXLTabContent">'+e+"</div>";currentTab.container.html(o+l),currentTab.container.data("loaded",!0),currentTab.container[0].tabUtils.state.status=exlTabState.FETCHED}},-1==e.inArray("onTabReady",Object.keys(r))&&(r.onTabReady=function(){})}}catch(u){console.log("unable to load tab")}return r}function f(e){var t=[],n=e.find(".EXLResultTab").length;for(k=0;n>k;k++)t.push(d(e,k));return null==t.addTab&&(t.addTab=function(t,n){n.record=e,p(t,n)}),t.getNames=function(){return tabNames=[],jQuery.each(t,function(){tabNames.push(this.name)}),tabNames},t.getEnabled=function(){return jQuery.map(e.tabs,function(t,n){return t=jQuery(t),"none"!=t.css("display")?e.tabs[n].name:null})},t.getByName=function(t){return d(e,t)},t}function p(e,t){defaults={record:null,state:"disabled",css:e.trim().toLowerCase().replace(/tab$/,"")+"Tab",url:"#",url_target:"",tooltip:"",label:e,headerContent:"",click:function(){alert("To be implemented...")}};var n=jQuery.extend(defaults,t);if(jQuery.inArray(e,n.record.tabs.getNames())<0){var r="exlidResult"+n.record.index+"-"+e,a='<li id="'+r+'" class="EXLResultTab '+n.css+'" name="'+e+'">';a+='  <span style="display:'+("disabled"==n.state?"block":"none")+'">'+n.label+"</span>",a+='  <a id="'+r+'Link" style="display:'+("disabled"==n.state?"none":"block")+'"',a+='     title="'+(n.tooltip||n.label)+'"',a+='     target="'+n.url_target+'"',a+='      href="'+n.url+'">'+n.label+"</a>",a+="</li>";var i='<div class="EXLResultTabContainer EXLContainer-'+n.css+'"></div>';n.record.find(".EXLResultTab").last().after(a),n.record.hasClass("EXLSummary")?n.record.append(i):n.record.find(".EXLSummary").append(i);var o="Container-"+n.css,l=n.record.find('*[class*="'+o+'"]');l&&(l=l[0],-1==jQuery.inArray("tabUtils",Object.keys(l))&&(l.tabUtils=new TabSet(o,n.record.tabs.length,l,n.record.id,e)));var u="."+n.css+" a";null!==n.click&&n.record.find(u).click(function(t){t.preventDefault(),"enabled"==n.state&&(tab=n.record.tabs.getByName(e),n.click(t,tab,n.record,n),y(n.record,tab[0]))})}n.record.tabs=f(n.record)}function y(t,n){if(null!=n.container){var r=n.container[0].tabUtils;if(r){var a=null,i=0;a=setInterval(function(){r.isTabReady()?(clearTimeout(a),console.log("firing tabReady for "+n.id),-1!=e.inArray("onTabReady",Object.keys(n))&&n.onTabReady(t,n.container[0],n)):(i>10?(clearTimeout(a),console.log("timing out tabReady for "+n.id)):console.log("not ready tabReady for "+n.id),i++)},500)}}}function b(){function t(e,t,a){return a="undefined"==typeof a?!1:a,a?r(e,t):n(e,t)}function n(e,t){for(var n,r,a=/{{(.+?)}}/g,i=/(^( )?(var|if|for|else|switch|case|break|{|}|;))(.*)?/g,o="with(obj) { var r=[];\n",l=0,u=function(e,t){return o+=t?e.match(i)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",u};r=a.exec(e);)u(e.slice(l,r.index))(r[1],!0),l=r.index+r[0].length;u(e.substr(l,e.length-l)),o=(o+'return r.join(""); }').replace(/[\r\t\n]/g,"");try{n=new Function("obj",o).apply(t,[t])}catch(c){console.error("'"+c.message+"'"," in \n\nCode:\n",o,"\n")}return n}function r(n,r){var a=e.Deferred();try{a.resolve(t(n,r))}catch(i){a.reject(function(){return console.log("Error rendering template: "+id,i),""})}return a.promise()}return{render:function(e,n,r){return r="undefined"==typeof r?!1:r,t(e,n,r)},renderById:function(n,r,a){a="undefined"==typeof a?!1:a;var i=e("#"+n).html();return t(i,r,a)}}}function g(t,n){function r(t,o){if(!t)return null;{var l="",u=null,c=null;t.nodeType,a(t.localName||t.nodeName),t.text||t.nodeValue||""}t.childNodes&&t.childNodes.length>0&&e.each(t.childNodes,function(e,t){var n=t.nodeType,o=a(t.localName||t.nodeName),c=t.text||t.nodeValue||"";if(8!=n)if(3!=n&&4!=n&&o)u=u||{},u[o]?(u[o].length||(u[o]=i(u[o])),u[o]=i(u[o]),u[o][u[o].length]=r(t,!0),u[o].length=u[o].length):u[o]=r(t);else{if(c.match(/^\s+$/))return;l+=c.replace(/^\s+/,"").replace(/\s+$/,"")}}),t.attributes&&t.attributes.length>0&&(c={},u=u||{},e.each(t.attributes,function(e,t){var n=a(t.name),r=t.value;c[n]=r,u[n]?(u[cnn]=i(u[cnn]),u[n][u[n].length]=r,u[n].length=u[n].length):u[n]=r})),u&&(u=e.extend(""!=l?new String(l):{},u||{}),l=u.text?[u.text||""].concat([l]):l,l&&(u.text=l),l="");var s=u||l;return n&&(l&&(s={}),l=s.text||l||"",l&&(s.text=l),o||(s=i(s))),s}if(!t)return{};var a=function(e){return String(e||"").replace(/-/g,"_")},i=function(t){return e.isArray(t)||(t=[t]),t.length=t.length,t};if("string"==typeof t&&(t=h(t)),t.nodeType){if(3==t.nodeType||4==t.nodeType)return t.nodeValue;var o=9==t.nodeType?t.documentElement:t,l=r(o,!0);return t=null,o=null,l}}function h(t){return e.parseXML(t)}function m(e){var t;return t=window.ActiveXObject?e.xml:(new XMLSerializer).serializeToString(e)}jQuery.PRIMO={parameters:{base_path:"/primo_library/libweb/jqp"}},String.prototype.startsWith||(String.prototype.startsWith=function(e){return!this.indexOf(e)});var v=function(t,n){var r=null;return void 0===n&&(n="text"),jQuery.ajax({async:!1,type:"get",dataType:"xml",url:jQuery.PRIMO.parameters.base_path+"/record/"+t+".pnx"}).then(function(t,a,i){if(i.getResponseHeader("Content-Type").search(/xml/)>=0)switch(n){case"text":r=m(t);break;case"json":r=e(g(t));break;default:r=e(t)}else alert("PDS redirect detected. Do not know how to handle that, yet.")},function(){var a="/primo_library/libweb/action/display.do?vid="+jQuery.PRIMO.session.view.code+"&pds_handle=GUEST&doc="+t+"&showPnx=true";jQuery.ajax({async:!1,type:"get",dataType:"xml",url:a}).then(function(t,a,i){if(i.getResponseHeader("Content-Type").search(/xml/)>=0)switch(n){case"text":r=m(t);break;case"json":r=e(g(t));break;default:r=e(t)}else alert("PDS redirect detected. Do not know how to handle that, yet.")},function(e,t,n){alert("Unable to load record:"+n)})}),e.isArray(r)?r[0]:r},j=function(){var e=null;return{data:function(){return e||(e={},jQuery.ajax({async:!1,type:"get",cache:!1,dataType:"xml",url:"/primo_library/libweb/getUserInfoServlet",success:function(t){e.id=jQuery(t).find("userId").text(),e.name=jQuery(t).find("userName").text(),e.loggedIn="true"===jQuery(t).find("isLoggedIn").text()}})),e}}}(),x=function(){var t=null,n=function(){return t?void 0:(t={},jQuery.ajax({async:!1,type:"get",cache:!1,dataType:"json",url:jQuery.PRIMO.parameters.base_path+"/session",success:function(e){t=jQuery.extend(!0,{},e),t.user.isLoggedIn=function(){return e.user.isLoggedIn},t.user.isOnCampus=function(){return e.user.isOnCampus}},error:function(){t={view:{code:e("#vid").val()},user:{id:j.data().id,name:j.data().name,isLoggedIn:function(){return j.data().loggedIn}}}}}),e.extend(t.view,{isFullDisplay:function(){return window.isFullDisplay()}}),t.reload=function(){return t=null,jQuery.PRIMO.session=n(),t},"undefined"!=typeof window.performance&&"undefined"!=typeof window.performance.timing&&(t.performance={timing:{getNetworkLatency:function(){return performance.timing.responseEnd-performance.timing.fetchStart},getPageRender:function(){return performance.timing.loadEventEnd-performance.timing.responseEnd},getPageLoad:function(){return performance.timing.loadEventEnd-performance.timing.navigationStart}}}),t)};return n()};jQuery.extend(jQuery.PRIMO,{facets:t(),query:n(),records:function(){var t=[],n=jQuery(".EXLResult").length,a=[];jQuery.ajax({async:!1,type:"get",dataType:"json",url:"/primo_library/libweb/jqp/record/*.json"}).then(function(e){jQuery.each(e,function(e,t){a[t.control.recordid]=t})});for(var i=0;n>i;i++)t.push(r(i,a));return e(".EXLResultTabs a").on("click",function(){try{var t=e(this).parent()[0],n=parseInt(e(t).closest(".EXLResult")[0].id.replace(/[^\d]/g,"")),r=jQuery.PRIMO.records[n];y(r,t)}catch(a){console.log(a)}}),e(t)}(),search:s(),session:x(),version:"1.1.7",reload:function(){jQuery.PRIMO.session.reload()},template:b()})}(jQuery);